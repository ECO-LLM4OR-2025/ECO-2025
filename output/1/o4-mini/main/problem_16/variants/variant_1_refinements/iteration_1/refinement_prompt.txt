You are an expert operations research analyst. Based on the detailed diagnostic evaluation below, please generate an improved Gurobi solution for this optimization problem.

    ## Problem Description:
    A store plans to formulate the purchasing and sales plan for a certain product for the first quarter of next year. It is known that the warehouse capacity of the store can store up to 500 units of the product, and there are 200 units in stock at the end of this year. The store purchases goods once at the beginning of each month. The purchasing and selling prices of the product in each month are shown in Table 1.3.

Table 1.3

| Month | 1 | 2 | 3 |
| :---: | :---: | :---: | :---: |
| Purchasing Price (Yuan) | 8 | 6 | 9 |
| Selling Price (Yuan) | 9 | 8 | 10 |

Now, determine how many units should be purchased and sold each month to maximize the total profit, and express this problem as a linear programming model.

    ## Current Iteration: 1

    ## Diagnostic Evaluation Results:
    **DIMENSION 1 – Definition Consistency:**  
Diagnosis:  
The model’s sets, variables, and parameters correctly mirror the verbal description of purchases, sales, and inventory balance over three months. The purchasing and selling prices, initial inventory, and warehouse capacity all match the problem statement.

Issues Found:  
- The original problem statement never mentions any limits on how much can be sold in each month (demand). As formulated, sales quantities s_t are unconstrained aside from inventory balance.  
- There is no supplier‐side capacity or budget constraint on purchases, so q_t is also unbounded above.  

Confidence: High  

---

**DIMENSION 2 – Structural Soundness:**  
Diagnosis:  
The inventory‐flow constraints and capacity limits are correctly written and linear; the objective is properly set to maximize total profit. Variable types (continuous, ≥0) are appropriate if fractional units are allowed.

Issues Found:  
- Missing demand constraints of the form s_t ≤ D_t (one per month) that cap how much can actually be sold.  
- (Optionally) Missing any upper bound on q_t (e.g. supplier capacity or budget). Without these, the LP is unbounded.  

Confidence: High  

---

**DIMENSION 3 – Numerical Validity:**  
Diagnosis:  
Gurobi reports “Infeasible or unbounded model.” Given the structure, it is in fact unbounded: a positive margin exists in month 2 (buy at 6, sell at 8) and month 3 (buy at 9, sell at 10). With no demand ceiling, one can buy arbitrary quantities, sell them immediately (keeping end‐of‐month inventory = 0 to respect capacity), and drive profit to +∞.

Issues Found:  
- No upper bounds on q_t or s_t ⇒ unbounded objective.  
- The “Infeasible or unbounded” message stems from Gurobi’s presolve detecting unboundedness.

Confidence: High  

---

OVERALL ASSESSMENT:  
Primary Issues:  
1. Lack of demand constraints s_t ≤ D_t ⇒ unbounded sales and profit.  
2. No caps on purchase quantities (supplier capacity or budget), reinforcing unboundedness.  

Recommended Actions:  
- Introduce monthly demand parameters D_1, D_2, D_3 and add constraints s[t] ≤ D[t] for t∈{1,2,3}.  
- If applicable, add supplier or budget limits on purchases (e.g. q[t] ≤ Q_max[t]).  
- Re‐solve and verify that the model becomes bounded and yields a finite optimal plan.  



    ## Current 5element to Improve:
    Sets:
- T = {1, 2, 3} (months in the first quarter)

Variables (all continuous, nonnegative):
- q_t ≥ 0: quantity purchased at the beginning of month t, ∀ t ∈ T
- s_t ≥ 0: quantity sold during month t, ∀ t ∈ T
- I_t ≥ 0: inventory at the end of month t, ∀ t ∈ T

Parameters:
- p_buy_t: purchasing price in month t, where p_buy_1=8, p_buy_2=6, p_buy_3=9
- p_sell_t: selling price in month t, where p_sell_1=9, p_sell_2=8, p_sell_3=10
- I_0 = 200: initial inventory at the end of last year
- C = 500: warehouse capacity (max inventory)

Constraints:
1. Inventory balance for each t ∈ T:
   I_{t-1} + q_t − s_t = I_t
   (with I_0 given = 200)
2. Capacity limit for each t ∈ T:
   I_t ≤ C
3. Nonnegativity:
   q_t ≥ 0, s_t ≥ 0, I_t ≥ 0  ∀ t ∈ T

Objective:
Maximize total profit = Σ_{t∈T} [ p_sell_t * s_t − p_buy_t * q_t ]

    ## Current Solution to Improve:
    ```python
    import gurobipy as gp
from gurobipy import GRB

# Data
T = [1, 2, 3]
p_buy = {1: 8, 2: 6, 3: 9}
p_sell = {1: 9, 2: 8, 3: 10}
I0 = 200
C = 500

# Model
m = gp.Model("quarterly_inventory")

# Decision variables
q = m.addVars(T, lb=0, name="q")    # purchase quantities
s = m.addVars(T, lb=0, name="s")    # sales quantities
I = m.addVars(T, lb=0, name="I")    # end-of-month inventories

# Inventory balance constraints
for t in T:
    if t == 1:
        m.addConstr(I0 + q[t] - s[t] == I[t], name=f"balance_{t}")
    else:
        m.addConstr(I[t-1] + q[t] - s[t] == I[t], name=f"balance_{t}")

# Capacity constraints
for t in T:
    m.addConstr(I[t] <= C, name=f"cap_{t}")

# Objective: maximize profit
m.setObjective(gp.quicksum(p_sell[t] * s[t] - p_buy[t] * q[t] for t in T), GRB.MAXIMIZE)

# Solve
m.optimize()

# Save optimal value
if m.status == GRB.OPTIMAL:
    with open('ref_optimal_value.txt', 'w') as f:
        f.write(str(m.objVal))
else:
    with open('ref_optimal_value.txt', 'w') as f:
        f.write("No optimal solution found.")
    ```

    ## Instructions for Improvement:

    Based on the diagnostic evaluation above, please generate a completely new and improved Gurobi code that addresses ALL identified issues. 

    **Requirements:**
    1. Address each issue identified in the diagnostic evaluation
    2. Ensure the code can run successfully without errors
    3. Save the final optimal value to 'ref_optimal_value.txt' (value only, no extra text)
    4. Use proper Gurobi syntax and best practices
    5. Include appropriate error handling
    6. Add clear comments explaining key modeling decisions

    **Code Generation Format:**
    First, provide a brief explanation of the key improvements you're making, then provide the complete code between ===== markers:

    Key Improvements:
    [Explain the main changes you're making to address the identified issues]

    =====
    import gurobipy as gp
    from gurobipy import GRB

    # Your improved code here
    # Make sure to save only the optimal value to 'ref_optimal_value.txt'
    =====

    Please ensure the generated code is complete, executable, and addresses all the issues identified in the diagnostic evaluation.
    