You are an expert operations research analyst. Based on the detailed diagnostic evaluation below, please generate an improved Gurobi solution for this optimization problem.

    ## Problem Description:
    A store plans to formulate the purchasing and sales plan for a certain product for the first quarter of next year. It is known that the warehouse capacity of the store can store up to 500 units of the product, and there are 200 units in stock at the end of this year. The store purchases goods once at the beginning of each month. The purchasing and selling prices of the product in each month are shown in Table 1.3.

Table 1.3

| Month | 1 | 2 | 3 |
| :---: | :---: | :---: | :---: |
| Purchasing Price (Yuan) | 8 | 6 | 9 |
| Selling Price (Yuan) | 9 | 8 | 10 |

Now, determine how many units should be purchased and sold each month to maximize the total profit, and express this problem as a linear programming model.

    ## Current Iteration: 3

    ## Diagnostic Evaluation Results:
    **DIMENSION 1 – Definition Consistency**  
Diagnosis:  
- The code stub includes only imports and no actual definitions of decision variables (purchase quantities `x_t`, sales quantities `y_t`, inventory levels `I_t`).  
- None of the parameters stated in the problem (warehouse capacity = 500, initial stock = 200, monthly purchase prices [8,6,9], selling prices [9,8,10]) appear in the model.  
- No mapping from “month 1,2,3” to any index in the code.  
- The scope (3 periods, single product) isn’t represented.  

Issues Found:  
1. Variables `purchase[t]`, `sale[t]`, `inv[t]` are not defined.  
2. Parameters capacity, initial stock, price arrays are missing.  
3. No index set for months; problem scope not captured.  

Confidence: High  

**DIMENSION 2 – Structural Soundness**  
Diagnosis:  
- There is no objective function coded—should be maximize ∑ₜ (sell_priceₜ·yₜ – buy_priceₜ·xₜ).  
- Inventory balance constraints (Iₜ₋₁ + xₜ – yₜ = Iₜ) are absent.  
- Warehouse capacity constraint (Iₜ ≤ 500) is missing.  
- Nonnegativity (and possibly integrality) of xₜ, yₜ, Iₜ is not enforced.  
- Model type is unclear; this is a linear program (continuous or integer) but no variable types are set.  

Issues Found:  
1. Missing objective function  
2. Missing inventory flow constraints  
3. Missing capacity constraint  
4. Missing nonnegativity/integrality on variables  
5. No model sense (maximize vs minimize)  

Confidence: High  

**DIMENSION 3 – Numerical Validity**  
Diagnosis:  
- The solver produces “Success” but without any variables or objective, the result is vacuously feasible but meaningless.  
- There is no reported objective value to judge reasonableness.  
- No infeasibility or unboundedness is detected simply because no constraints or objective are present.  

Issues Found:  
1. No numerical results (objective or decision values) to validate  
2. Constraints’ RHS and coefficients not present to check scales  

Confidence: Medium  

**OVERALL ASSESSMENT**  
Primary Issues:  
1. The model code is essentially empty—no variables, objective, or constraints.  
2. Key problem data (prices, capacity, initial stock) are never instantiated.  
3. Without an objective or constraints, the numerical solution is meaningless.  

Recommended Actions:  
1. Define index set Months = [1,2,3], parameters:  
   • buy_price = {1:8, 2:6, 3:9}  
   • sell_price = {1:9, 2:8, 3:10}  
   • capacity = 500, I0 = 200  
2. Add decision variables:  
   • x[t] ≥ 0  (units purchased in month t)  
   • y[t] ≥ 0  (units sold in month t)  
   • I[t] ≥ 0  (inventory at end of month t)  
3. Build constraints:  
   • Inventory balance: I[t–1] + x[t] – y[t] = I[t]  for t=1..3  (with I[0]=200)  
   • Capacity: I[t] ≤ 500  for t=1..3  
4. Set objective:  
   maximize ∑ₜ (sell_price[t] * y[t] – buy_price[t] * x[t])  
5. Specify model sense = GRB.MAXIMIZE, variable types (continuous or integer).  
6. Solve and report objective and variable values for validation.  

Implementing these steps will yield a valid, fully specified LP whose optimal solution can be meaningfully interpreted.

    ## Current 5element to Improve:
    No 5element_description

    ## Current Solution to Improve:
    ```python
    import gurobipy as gp
from gurobipy import GRB
import sys

#
    ```

    ## Instructions for Improvement:

    Based on the diagnostic evaluation above, please generate a completely new and improved Gurobi code that addresses ALL identified issues. 

    **Requirements:**
    1. Address each issue identified in the diagnostic evaluation
    2. Ensure the code can run successfully without errors
    3. Save the final optimal value to 'ref_optimal_value.txt' (value only, no extra text)
    4. Use proper Gurobi syntax and best practices
    5. Include appropriate error handling
    6. Add clear comments explaining key modeling decisions

    **Code Generation Format:**
    First, provide a brief explanation of the key improvements you're making, then provide the complete code between ===== markers:

    Key Improvements:
    [Explain the main changes you're making to address the identified issues]

    =====
    import gurobipy as gp
    from gurobipy import GRB

    # Your improved code here
    # Make sure to save only the optimal value to 'ref_optimal_value.txt'
    =====

    Please ensure the generated code is complete, executable, and addresses all the issues identified in the diagnostic evaluation.
    