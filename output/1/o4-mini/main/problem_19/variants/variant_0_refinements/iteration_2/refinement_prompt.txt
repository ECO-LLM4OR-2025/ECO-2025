You are an expert operations research analyst. Based on the detailed diagnostic evaluation below, please generate an improved Gurobi solution for this optimization problem.

    ## Problem Description:
    A furniture store can choose to order chairs from three different manufacturers: A, B, and C. The cost of ordering each chair from manufacturer A is $50, from manufacturer B is $45, and from manufacturer C is $40. The store needs to minimize the total cost of the order.

Additionally, each order from manufacturer A will include 15 chairs, while each order from manufacturers B and C will include 10 chairs. The number of orders must be an integer. The store needs to order at least 100 chairs.

Each order from manufacturer A will include 15 chairs, while each order from manufacturers B and C will include 10 chairs. The store needs to order at most 500 chairs.

If the store decides to order chairs from manufacturer A, it must also order at least 10 chairs from manufacturer B.

Furthermore, if the store decides to order chairs from manufacturer B, it must also order chairs from manufacturer C.

    ## Current Iteration: 2

    ## Diagnostic Evaluation Results:
    **DIMENSION 1 – Definition Consistency:**  
Diagnosis: The model’s data and variable definitions match the narrative. “manufacturers” A, B, C are correctly represented. chairs_per_order and cost_per_chair agree with 15/10/10 chairs and \$50/\$45/\$40 rates. Decision variables x[i] (“number of orders”) and y[i] (“use flag”) are named and scoped appropriately. The minimum (100) and maximum (500) chair bounds are in place.  
Issues Found: None  
Confidence: High  

**DIMENSION 2 – Structural Soundness:**  
Diagnosis:  
- Objective: correctly minimizes total cost of orders (cost_per_order = chairs_per_order × cost_per_chair).  
- Constraints:  
  • Total chairs ≥100 and ≤500.  
  • Linking x–y: y=0⇒x=0, y=1⇒x≥1, x≤M·y embody correct logical relationships.  
  • Implications A⇒B and B⇒C via indicator constraints enforce “if A used then B used (≥1 order ⇒10 chairs), if B used then C used.”  
- Model type: Mixed‐integer (integer x, binary y) is appropriate.  
No missing constraints nor redundant ones. All variables are correctly typed.  
Issues Found: None  
Confidence: High  

**DIMENSION 3 – Numerical Validity:**  
Diagnosis: The solver returns an optimal cost of 4000, which corresponds to ordering exactly 10 batches from C (10×10 chairs=100 chairs at \$40 each ⇒ \$4,000). That is the cheapest feasible solution, since C is the lowest‐cost source and the model does not force use of A or B. Constraints are neither infeasible nor unbounded; right‐hand sides and coefficients are reasonable.  
Issues Found: None  
Confidence: High  

OVERALL ASSESSMENT:  
Primary Issues: None detected.  
Recommended Actions: The formulation is correct as‐is. No changes necessary.  


    ## Current 5element to Improve:
    No 5element_description

    ## Current Solution to Improve:
    ```python
    import gurobipy as gp
from gurobipy import GRB

def main():
    try:
        # Data setup
        manufacturers     = ["A", "B", "C"]
        chairs_per_order  = {"A": 15, "B": 10, "C": 10}
        cost_per_chair    = {"A": 50, "B": 45, "C": 40}
        # Precompute cost per order
        cost_per_order    = {i: chairs_per_order[i] * cost_per_chair[i] 
                              for i in manufacturers}
        min_chairs, max_chairs = 100, 500
        # Big‐M values for upper linking
        M = {i: max_chairs // chairs_per_order[i] for i in manufacturers}

        # Create model
        model = gp.Model("furniture_ordering")
        # Suppress solver output
        model.Params.OutputFlag = 0

        # Decision variables
        # x[i]: number of orders from i (integer ≥ 0)
        # y[i]: binary flag, 1 if manufacturer i is used
        x = model.addVars(manufacturers, vtype=GRB.INTEGER, lb=0, name="orders")
        y = model.addVars(manufacturers, vtype=GRB.BINARY,  name="use")

        # Constraints
        # 1) Total chairs bounds
        model.addConstr(
            gp.quicksum(chairs_per_order[i] * x[i] for i in manufacturers) 
            >= min_chairs, name="min_chairs")
        model.addConstr(
            gp.quicksum(chairs_per_order[i] * x[i] for i in manufacturers) 
            <= max_chairs, name="max_chairs")

        # 2) Link x and y variables via indicator constraints:
        #    y[i]=0 ⇒ x[i]=0 ;  y[i]=1 ⇒ x[i]≥1 ; and x[i] ≤ M[i]*y[i]
        for i in manufacturers:
            model.addGenConstrIndicator(y[i], 0, x[i] == 0, name=f"zero_{i}")
            model.addGenConstrIndicator(y[i], 1, x[i] >= 1, name=f"one_{i}")
            model.addConstr(x[i] <= M[i] * y[i],         name=f"up_{i}")

        # 3) Logical implications via indicators
        #    If A is used then B must be used; if B is used then C must be used
        model.addGenConstrIndicator(y["A"], 1, y["B"] == 1, name="A_implies_B")
        model.addGenConstrIndicator(y["B"], 1, y["C"] == 1, name="B_implies_C")

        # Objective: minimize total cost
        model.setObjective(
            gp.quicksum(cost_per_order[i] * x[i] for i in manufacturers),
            GRB.MINIMIZE)

        # Optimize
        model.optimize()

        # Output optimal value if found
        if model.Status == GRB.OPTIMAL:
            with open("ref_optimal_value.txt", "w") as f:
                f.write(str(int(model.ObjVal)))

    except gp.GurobiError as e:
        print(f"Gurobi Error: {e}")
    except Exception as e:
        print(f"General Error: {e}")

if __name__ == "__main__":
    main()
    ```

    ## Instructions for Improvement:

    Based on the diagnostic evaluation above, please generate a completely new and improved Gurobi code that addresses ALL identified issues. 

    **Requirements:**
    1. Address each issue identified in the diagnostic evaluation
    2. Ensure the code can run successfully without errors
    3. Save the final optimal value to 'ref_optimal_value.txt' (value only, no extra text)
    4. Use proper Gurobi syntax and best practices
    5. Include appropriate error handling
    6. Add clear comments explaining key modeling decisions

    **Code Generation Format:**
    First, provide a brief explanation of the key improvements you're making, then provide the complete code between ===== markers:

    Key Improvements:
    [Explain the main changes you're making to address the identified issues]

    =====
    import gurobipy as gp
    from gurobipy import GRB

    # Your improved code here
    # Make sure to save only the optimal value to 'ref_optimal_value.txt'
    =====

    Please ensure the generated code is complete, executable, and addresses all the issues identified in the diagnostic evaluation.
    