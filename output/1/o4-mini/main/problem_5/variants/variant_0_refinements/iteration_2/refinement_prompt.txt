You are an expert operations research analyst. Based on the detailed diagnostic evaluation below, please generate an improved Gurobi solution for this optimization problem.

    ## Problem Description:
    A flooring company produces engineered hardwood and vinyl planks. Their sales forecasts show an expected demand of at least 20,000 square foot of hardwood and 10,000 square feet of vinyl planks each week. To satisfy a shipping contract, a total of at least 60,000 square feet of flooring much be shipped each week. Due to a labor shortage issue, no more than 50,000 square feet of hardwood and 30,000  square feet of vinyl  can be produced weekly. If a square foot of hardwood flooring yields a profit of $2.5 and a square foot of vinyl planks produces a $3 profit, how many of each type of flooring should be made weekly to maximize the company's profit?

    ## Current Iteration: 2

    ## Diagnostic Evaluation Results:
    **DIMENSION 1 - Definition Consistency:**  
Diagnosis: The code’s decision‐variable names, parameter names and values all correspond exactly to the problem statement. ‘profit_h’, ‘profit_v’, ‘demand_h’, ‘demand_v’, ‘ship_min’, ‘cap_h’ and ‘cap_v’ match the hardwood and vinyl profit, demand, shipping and capacity numbers given in the text. Both Gurobi and PuLP formulations introduce non‐negative continuous x_h and x_v to represent produced square feet. There are no extra products or missing entities.  
Issues Found: None  
Confidence: High  

**DIMENSION 2 - Structural Soundness:**  
Diagnosis:  
- Objective: Correctly maximizes 2.5·hardwood + 3·vinyl.  
- Constraints: Includes lower‐bounds for each product (demand), a combined lower‐bound for shipping, and upper‐bounds for capacity. Nonnegativity is enforced via lb=0.  
- No constraints are redundant (the shipping ≥60 000 can bind above the individual demands) nor missing.  
- The problem is a straightforward continuous linear program, and variable types are correctly continuous.  
Issues Found: None  
Confidence: High  

**DIMENSION 3 - Numerical Validity:**  
Diagnosis: The mathematical model is neither infeasible nor unbounded given the parameter values (feasible region exists between demand and capacity, and profit coefficients are finite). The failure occurs at runtime because neither Gurobi nor PuLP is installed in the environment, so the code aborts before solving.  
Issues Found:  
  1. Missing solver dependencies (Gurobi and PuLP are not available).  
Confidence: High  

OVERALL ASSESSMENT:  
Primary Issues:  
  1. The execution environment lacks the required solver libraries.  

Recommended Actions:  
  - Install a supported solver library (e.g. pip-install PuLP which bundles CBC, or install Gurobi and its Python API).  
  - Alternatively, modify the code to detect and install a pure-Python LP solver or invoke an external solver.  
  - Once a solver is present, rerun the model; the expected optimal solution is hardwood = 30 000 sqft, vinyl = 30 000 sqft (profit = \$165 000).

    ## Current 5element to Improve:
    No 5element_description

    ## Current Solution to Improve:
    ```python
    import sys

# Try importing Gurobi; if unavailable, fall back to PuLP
try:
    import gurobipy as gp
    from gurobipy import GRB
    SOLVER = 'gurobi'
except ModuleNotFoundError:
    try:
        from pulp import LpProblem, LpVariable, LpMaximize, value, PULP_CBC_CMD
        SOLVER = 'pulp'
    except ModuleNotFoundError:
        sys.exit("Error: Neither Gurobi nor PuLP is available. Please install one of these solvers.")

# Model parameters
params = {
    'profit_h': 2.5,    # profit per sqft hardwood
    'profit_v': 3.0,    # profit per sqft vinyl
    'demand_h': 20000,  # min demand hardwood
    'demand_v': 10000,  # min demand vinyl
    'ship_min': 60000,  # min total shipping
    'cap_h': 50000,     # max capacity hardwood
    'cap_v': 30000      # max capacity vinyl
}

# Solve with Gurobi
if SOLVER == 'gurobi':
    # Create Gurobi model
    model = gp.Model("flooring_production")
    model.Params.OutputFlag = 0  # Turn off solver output for clarity

    # Decision variables: x_h and x_v
    x = model.addVars(
        ['hardwood', 'vinyl'],
        lb=0.0,
        name="production"
    )

    # Demand constraints
    model.addConstr(x['hardwood'] >= params['demand_h'], name="hardwood_demand")
    model.addConstr(x['vinyl']   >= params['demand_v'], name="vinyl_demand")

    # Shipping requirement
    model.addConstr(x['hardwood'] + x['vinyl'] >= params['ship_min'], name="total_shipping")

    # Capacity constraints
    model.addConstr(x['hardwood'] <= params['cap_h'], name="hardwood_capacity")
    model.addConstr(x['vinyl']   <= params['cap_v'], name="vinyl_capacity")

    # Objective: maximize total profit
    model.setObjective(
        params['profit_h'] * x['hardwood'] +
        params['profit_v'] * x['vinyl'],
        GRB.MAXIMIZE
    )

    # Optimize
    model.optimize()

    # Check for optimality
    if model.status != GRB.OPTIMAL:
        raise RuntimeError(f"Gurobi optimization ended with status {model.status}")

    optimal_value = model.objVal

# Solve with PuLP (fallback)
else:
    # Create PuLP problem
    model = LpProblem("flooring_production", LpMaximize)

    # Decision variables
    x_h = LpVariable("hardwood_sqft", lowBound=0)
    x_v = LpVariable("vinyl_sqft", lowBound=0)

    # Objective
    model += params['profit_h'] * x_h + params['profit_v'] * x_v

    # Constraints
    model += x_h >= params['demand_h'], "hardwood_demand"
    model += x_v >= params['demand_v'], "vinyl_demand"
    model += x_h + x_v >= params['ship_min'], "total_shipping"
    model += x_h <= params['cap_h'], "hardwood_capacity"
    model += x_v <= params['cap_v'], "vinyl_capacity"

    # Solve using the default CBC solver
    result_status = model.solve(PULP_CBC_CMD(msg=False))
    if result_status != 1:  # 1 corresponds to LpStatusOptimal
        raise RuntimeError(f"PuLP optimization ended with status {result_status}")

    optimal_value = value(model.objective)

# Write only the numeric optimal value to file
with open('ref_optimal_value.txt', 'w') as f:
    f.write(f"{optimal_value}")
    ```

    ## Instructions for Improvement:

    Based on the diagnostic evaluation above, please generate a completely new and improved Gurobi code that addresses ALL identified issues. 

    **Requirements:**
    1. Address each issue identified in the diagnostic evaluation
    2. Ensure the code can run successfully without errors
    3. Save the final optimal value to 'ref_optimal_value.txt' (value only, no extra text)
    4. Use proper Gurobi syntax and best practices
    5. Include appropriate error handling
    6. Add clear comments explaining key modeling decisions

    **Code Generation Format:**
    First, provide a brief explanation of the key improvements you're making, then provide the complete code between ===== markers:

    Key Improvements:
    [Explain the main changes you're making to address the identified issues]

    =====
    import gurobipy as gp
    from gurobipy import GRB

    # Your improved code here
    # Make sure to save only the optimal value to 'ref_optimal_value.txt'
    =====

    Please ensure the generated code is complete, executable, and addresses all the issues identified in the diagnostic evaluation.
    